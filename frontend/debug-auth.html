<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Autentica√ß√£o - Recicla F√°cil</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .debug-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background: #d4edda; border-color: #c3e6cb; }
        .error { background: #f8d7da; border-color: #f5c6cb; }
        .info { background: #d1ecf1; border-color: #bee5eb; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
    </style>
</head>
<body>
    <h1>üîß Debug de Autentica√ß√£o</h1>
    
    <div class="debug-section info">
        <h3>Status Atual</h3>
        <div id="status"></div>
    </div>
    
    <div class="debug-section">
        <h3>Teste de Login</h3>
        <button onclick="testLogin()">Testar Login</button>
        <button onclick="testLogout()">Testar Logout</button>
        <button onclick="refreshStatus()">Atualizar Status</button>
    </div>
    
    <div class="debug-section">
        <h3>Informa√ß√µes de Debug</h3>
        <div id="debug-info"></div>
    </div>

    <script>
        function updateStatus() {
            const statusDiv = document.getElementById('status');
            const debugDiv = document.getElementById('debug-info');
            
            // Verificar localStorage
            const session = JSON.parse(localStorage.getItem('rf_session') || 'null');
            
            // Verificar se h√° sess√£o
            const hasSession = !!(session && session.user && session.token);
            const hasUser = !!(session && session.user);
            const hasToken = !!(session && session.token);
            
            statusDiv.innerHTML = `
                <p><strong>Sess√£o:</strong> ${hasSession ? '‚úÖ Ativa' : '‚ùå Inativa'}</p>
                <p><strong>Usu√°rio:</strong> ${hasUser ? '‚úÖ Presente' : '‚ùå Ausente'}</p>
                <p><strong>Token:</strong> ${hasToken ? '‚úÖ Presente' : '‚ùå Ausente'}</p>
                <p><strong>Email:</strong> ${session?.user?.email || 'N/A'}</p>
                <p><strong>Nome:</strong> ${session?.user?.nome || 'N/A'}</p>
            `;
            
            debugDiv.innerHTML = `
                <h4>Dados da Sess√£o:</h4>
                <pre>${JSON.stringify(session, null, 2)}</pre>
            `;
        }
        
        function testLogin() {
            const loginData = {
                email: 'felpzzl1@gmail.com',
                senha: '123456'
            };
            
            fetch('http://localhost:9161/api/auth/login', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(loginData)
            })
            .then(response => response.json())
            .then(data => {
                console.log('Resposta do login:', data);
                
                if (data.success) {
                    // Salvar sess√£o como o frontend faria
                    const session = {
                        user: data.data,
                        profile: data.data,
                        token: data.data.token
                    };
                    localStorage.setItem('rf_session', JSON.stringify(session));
                    
                    alert('Login realizado com sucesso!');
                    updateStatus();
                } else {
                    alert('Erro no login: ' + data.message);
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro na requisi√ß√£o: ' + error.message);
            });
        }
        
        function testLogout() {
            localStorage.removeItem('rf_session');
            alert('Logout realizado!');
            updateStatus();
        }
        
        function refreshStatus() {
            updateStatus();
        }
        
        // Atualizar status inicial
        updateStatus();
        
        // Atualizar a cada 2 segundos
        setInterval(updateStatus, 2000);
    </script>
</body>
</html>
