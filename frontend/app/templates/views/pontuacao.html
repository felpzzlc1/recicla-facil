<div class="page-header">
  <div class="header-content">
    <div class="header-text">
      <h1 class="page-title">üå± Sua Jornada de Reciclagem</h1>
      <p class="page-subtitle">
        Acompanhe seus pontos, conquiste badges e veja como voc√™ se compara com outros recicladores da sua regi√£o!
      </p>
    </div>
    <div class="header-stats">
      <div class="stat-card">
        <div class="stat-icon">üèÜ</div>
        <div class="stat-info">
          <div class="stat-number">{{ pontuacaoCtrl.ranking.length || 0 }}</div>
          <div class="stat-label">Posi√ß√£o no Ranking</div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Loading State -->
<div ng-if="pontuacaoCtrl.carregando" class="loading-container">
  <div class="loading-spinner"></div>
  <p>Carregando suas estat√≠sticas...</p>
</div>

<!-- Error State -->
<div ng-if="pontuacaoCtrl.erro && !pontuacaoCtrl.carregando" class="error-container">
  <div class="error-message">
    <span class="error-icon">‚ö†Ô∏è</span>
    <p>{{ pontuacaoCtrl.erro }}</p>
    <div class="debug-info" style="margin: 16px 0; padding: 12px; background: #f8f9fa; border-radius: 4px; font-size: 0.875rem;">
      <strong>Debug Info:</strong><br>
      Logado: {{ AuthService.isLoggedIn() }}<br>
      Token: {{ AuthService.getToken() ? 'Presente' : 'Ausente' }}<br>
      Usu√°rio: {{ AuthService.getCurrentUser() ? AuthService.getCurrentUser().nome : 'Nenhum' }}
    </div>
    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
      <button class="btn btn-primary" ng-click="pontuacaoCtrl.carregarEstatisticas()">
        Tentar Novamente
      </button>
      <button class="btn btn-secondary" ng-click="pontuacaoCtrl.verificarLogin()" ng-if="!AuthService.isLoggedIn()">
        Fazer Login
      </button>
    </div>
  </div>
</div>

<!-- Main Content -->
<div ng-if="!pontuacaoCtrl.carregando && !pontuacaoCtrl.erro" class="gamification-grid">
  <div class="points-card">
    <div class="card-header">
      <div class="header-left">
        <h3 class="card-title">üéØ Seus Pontos</h3>
        <div class="level-badge">
          <span class="level-emoji">{{ pontuacaoCtrl.obterEmojiNivel() }}</span>
          <span class="level-text">{{ pontuacaoCtrl.nivelNome }}</span>
        </div>
      </div>
      <button class="btn btn-success btn-simular" ng-click="pontuacaoCtrl.abrirModalDescarte()" 
              ng-if="pontuacaoCtrl.verificarLogin()">
        <span class="btn-icon">‚ôªÔ∏è</span>
        Registrar Descarte
      </button>
    </div>
    
    <div class="points-display">
      <div class="current-points">{{ pontuacaoCtrl.formatarNumero(pontuacaoCtrl.pontos || 0) }}</div>
      <div class="points-increase" ng-if="pontuacaoCtrl.aumentoSemanal > 0">
        <span class="increase-icon">‚Üó</span>
        <span class="increase-text">+{{ pontuacaoCtrl.formatarNumero(pontuacaoCtrl.aumentoSemanal || 0) }} esta semana</span>
      </div>
    </div>
    
    <div class="level-progress">
      <div class="level-info">
        <span class="level-text">N√≠vel {{ pontuacaoCtrl.nivel }} - {{ pontuacaoCtrl.nivelNome }}</span>
        <div class="trophy-icon">{{ pontuacaoCtrl.obterEmojiNivel() }}</div>
      </div>
      
      <div class="progress-container">
        <div class="progress-bar">
          <div class="progress-fill" ng-style="{'width': pontuacaoCtrl.progressoNivel + '%', 'background-color': pontuacaoCtrl.obterCorNivel()}"></div>
        </div>
        <div class="progress-text">{{ pontuacaoCtrl.formatarNumero(pontuacaoCtrl.pontosAtuaisNivel || 0) }} / {{ pontuacaoCtrl.formatarNumero(pontuacaoCtrl.pontosNecessariosNivel || 100) }}</div>
      </div>
      
      <div class="next-level" ng-if="pontuacaoCtrl.pontosRestantes > 0">
        Faltam {{ pontuacaoCtrl.formatarNumero(pontuacaoCtrl.pontosRestantes || 0) }} pontos para o pr√≥ximo n√≠vel!
      </div>
    </div>
    
    <div class="stats-grid">
      <div class="stat-item">
        <div class="stat-icon">üéØ</div>
        <div class="stat-number">{{ pontuacaoCtrl.formatarNumero(pontuacaoCtrl.estatisticas.descartes || 0) }}</div>
        <div class="stat-label">Descartes</div>
      </div>
      <div class="stat-item">
        <div class="stat-icon">‚ö°</div>
        <div class="stat-number">{{ pontuacaoCtrl.formatarNumero(pontuacaoCtrl.estatisticas.sequencia || 0) }}</div>
        <div class="stat-label">Sequ√™ncia (dias)</div>
      </div>
      <div class="stat-item">
        <div class="stat-icon">üèÖ</div>
        <div class="stat-number">{{ pontuacaoCtrl.formatarNumero(pontuacaoCtrl.estatisticas.badges || 0) }}</div>
        <div class="stat-label">Badges</div>
      </div>
    </div>
  </div>
  
  <div class="achievements-card">
    <div class="card-header">
      <div class="achievements-title">
        <span class="star-icon">üèÜ</span>
        <h3 class="card-title">Conquistas</h3>
        <div class="achievements-count">
          {{ pontuacaoCtrl.getConquistasDesbloqueadas() }} / {{ pontuacaoCtrl.conquistas.length || 0 }}
        </div>
      </div>
    </div>
    
    <div class="achievements-list">
      <div ng-repeat="conquista in pontuacaoCtrl.conquistas" 
           class="achievement" 
           ng-class="{'unlocked': conquista.desbloqueada, 'locked': !conquista.desbloqueada}">
        <div class="achievement-icon">{{ conquista.icone }}</div>
        <div class="achievement-content">
          <div class="achievement-name">{{ conquista.nome }}</div>
          <div class="achievement-description">{{ conquista.descricao }}</div>
          <div class="achievement-progress" ng-if="!conquista.desbloqueada">
            <div class="progress-bar-small">
              <div class="progress-fill-small" ng-style="{'width': conquista.progresso + '%'}"></div>
            </div>
            <span class="progress-text-small">{{ conquista.progresso.toFixed(0) }}%</span>
          </div>
        </div>
        <div class="achievement-badge">
          <span ng-if="conquista.desbloqueada">‚úì</span>
          <span ng-if="!conquista.desbloqueada">üîí</span>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Simula√ß√£o de Descarte -->
<div ng-if="pontuacaoCtrl.mostrarModalDescarte" class="modal-overlay" ng-click="pontuacaoCtrl.fecharModalDescarte()">
  <div class="modal-content" ng-click="$event.stopPropagation()">
    <div class="modal-header">
      <h3>Registrar Descarte</h3>
      <button class="modal-close" ng-click="pontuacaoCtrl.fecharModalDescarte()">√ó</button>
    </div>
    
    <div class="modal-body">
      <div class="form-group">
        <label>Material:</label>
        <select ng-model="pontuacaoCtrl.materialSelecionado" 
                ng-change="pontuacaoCtrl.calcularPontos()"
                class="form-control">
          <option ng-repeat="material in pontuacaoCtrl.materiais" 
                  value="{{ material.codigo }}">
            {{ material.icone }} {{ material.nome }} ({{ material.pontosPorKg }} pts/kg)
          </option>
        </select>
      </div>
      
      <div class="form-group">
        <label>Peso (kg):</label>
        <input type="number" 
               ng-model="pontuacaoCtrl.pesoDescarte" 
               ng-change="pontuacaoCtrl.calcularPontos()"
               min="0.1" 
               max="100" 
               step="0.1"
               class="form-control">
      </div>
      
      <div class="points-preview" ng-if="pontuacaoCtrl.pontosCalculados > 0">
        <div class="points-preview-content">
          <span class="points-preview-icon">üéØ</span>
          <span class="points-preview-text">
            Voc√™ ganhar√° <strong>{{ pontuacaoCtrl.pontosCalculados }} pontos</strong>
          </span>
        </div>
      </div>
    </div>
    
    <div class="modal-footer">
      <button class="btn btn-secondary" ng-click="pontuacaoCtrl.fecharModalDescarte()">
        Cancelar
      </button>
      <button class="btn btn-success" 
              ng-click="pontuacaoCtrl.registrarDescarte()"
              ng-disabled="!pontuacaoCtrl.materialSelecionado || !pontuacaoCtrl.pesoDescarte || pontuacaoCtrl.pesoDescarte <= 0">
        <span ng-if="!pontuacaoCtrl.carregando">Registrar Descarte</span>
        <span ng-if="pontuacaoCtrl.carregando">Registrando...</span>
      </button>
    </div>
  </div>
</div>
