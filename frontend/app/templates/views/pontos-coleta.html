<div class="page-header">
  <h1 class="page-title">Pontos de Coleta</h1>
  <p class="page-subtitle">
    Encontre os pontos de coleta seletiva dispon√≠veis. Cada local aceita diferentes tipos de materiais recicl√°veis.
  </p>
</div>

<!-- Loading e Error States -->
<div ng-if="vm.loading" class="loading-container">
  <div class="loading-spinner"></div>
  <p>Carregando pontos de coleta...</p>
</div>

<div ng-if="vm.error && !vm.loading" class="error-container">
  <div class="error-icon">‚ö†Ô∏è</div>
  <p class="error-message">{{ vm.error }}</p>
  <button class="btn btn-primary" ng-click="vm.getUserLocation()">
    Tentar Novamente
  </button>
</div>

<!-- Localiza√ß√£o do usu√°rio -->
  <div ng-if="vm.userLocation && !vm.loading" class="location-info">
    <div class="location-badge">
      <span class="location-icon">üìç</span>
      <span ng-if="vm.cidade">Mostrando pontos em {{ vm.cidade }}</span>
      <span ng-if="!vm.cidade">Localiza√ß√£o detectada - Buscando pontos pr√≥ximos</span>
    </div>
    <div class="action-buttons">
      <button class="btn btn-primary" 
              ng-class="{'disabled': !vm.isLoggedIn()}"
              ng-disabled="!vm.isLoggedIn()"
              ng-click="vm.isLoggedIn() ? vm.abrirModalCadastro() : vm.openLoginModal()">
        <span>‚ûï</span>
        Cadastrar Ponto
      </button>
    </div>
  </div>

<!-- Grid de pontos de coleta -->
<div ng-if="!vm.loading && !vm.error" class="collection-points-grid">
  <div class="collection-point-card" 
       ng-repeat="p in vm.pontos" 
       ng-class="{'selected': vm.selectedPoint && vm.selectedPoint.id === p.id}"
       ng-click="vm.selectPoint(p)">
    
            <div class="card-header">
              <h3 class="point-name">{{ p.nome }}</h3>
              <div class="point-badges">
                <span ng-if="p.fonte === 'OpenStreetMap'" class="point-source osm">OSM</span>
                <span ng-if="p.tipo_origem === 'exemplo'" class="badge badge-orange">Exemplo</span>
                <span ng-if="p.tipo" class="badge badge-blue">{{ p.tipo }}</span>
                <span class="location-icon">üìç</span>
              </div>
            </div>
    
    <div class="point-info">
      <div class="info-item">
        <span class="info-icon">üìç</span>
        <span class="info-text">{{ p.distancia || 'Dist√¢ncia n√£o dispon√≠vel' }}</span>
      </div>
      <div class="info-item">
        <span class="info-icon">üè†</span>
        <span class="info-text">{{ p.endereco }}</span>
      </div>
      <div class="info-item">
        <span class="info-icon">üïí</span>
        <span class="info-text">{{ p.horario || 'Hor√°rio n√£o informado' }}</span>
      </div>
      <div class="info-item">
        <span class="info-icon">üìû</span>
        <span class="info-text">{{ p.telefone || 'Telefone n√£o informado' }}</span>
      </div>
    </div>
    
    <div class="accepted-materials">
      <span class="material-tag" 
            ng-repeat="material in p.materiais" 
            ng-class="{
              'badge-blue': material === 'Papel',
              'badge-red': material === 'Pl√°stico', 
              'badge-yellow': material === 'Metal',
              'badge-green': material === 'Vidro'
            }">
        {{ material }}
      </span>
    </div>
    
    <div class="card-actions">
      <button class="btn btn-secondary" 
              ng-click="vm.selectPoint(p); $event.stopPropagation()">
        <span>‚≠ê</span>
        Selecionar
      </button>
    </div>
  </div>
</div>

<!-- Mensagem quando n√£o h√° pontos -->
<div ng-if="!vm.loading && !vm.error && vm.pontos.length === 0" class="no-points">
  <div class="no-points-icon">üó∫Ô∏è</div>
  <h3>Nenhum ponto encontrado</h3>
  <p>N√£o foram encontrados pontos de coleta pr√≥ximos √† sua localiza√ß√£o.</p>
  <button class="btn btn-primary" ng-click="vm.getUserLocation()">
    Buscar Novamente
  </button>
</div>

<!-- Ponto selecionado - detalhes -->
<div ng-if="vm.selectedPoint" class="selected-point-details">
  <div class="details-card">
    <div class="details-header">
      <h3>Ponto Selecionado: {{ vm.selectedPoint.nome }}</h3>
      <button class="close-details" ng-click="vm.selectedPoint = null">‚úï</button>
    </div>
    <div class="details-content">
      <p><strong>Endere√ßo:</strong> {{ vm.selectedPoint.endereco }}</p>
      <p><strong>Telefone:</strong> {{ vm.selectedPoint.telefone }}</p>
      <p><strong>Hor√°rio:</strong> {{ vm.selectedPoint.horario }}</p>
      <p><strong>Dist√¢ncia:</strong> {{ vm.selectedPoint.distancia }}</p>
      <p><strong>Materiais aceitos:</strong> {{ vm.selectedPoint.materiais.join(', ') }}</p>
    </div>
    <div class="details-actions">
      <button class="btn btn-secondary" ng-click="vm.selectedPoint = null">
        Fechar
      </button>
    </div>
  </div>
</div>

<!-- Modal de Cadastro -->
<div class="modal-overlay" ng-if="vm.showModal" ng-click="vm.fecharModal()">
  <div class="modal-container" ng-click="$event.stopPropagation()">
    <div class="modal-header">
      <h3>üó∫Ô∏è Cadastrar Ponto de Coleta</h3>
      <button class="close-btn" ng-click="vm.fecharModal()">‚úï</button>
    </div>
    
    <div class="modal-body">
      <form ng-submit="vm.cadastrarPonto()" class="cadastro-form-modal">
        <!-- Informa√ß√µes B√°sicas -->
        <div class="form-section">
          <div class="form-group">
            <label for="nome">Nome do Ponto *</label>
            <input type="text" id="nome" ng-model="vm.formData.nome" required 
                   placeholder="Ex: Cooperativa Recicla Vida">
          </div>

          <div class="form-group">
            <label for="tipo">Tipo</label>
            <select id="tipo" ng-model="vm.formData.tipo">
              <option value="Cooperativa">Cooperativa</option>
              <option value="Ponto Verde">Ponto Verde</option>
              <option value="Ecoponto">Ecoponto</option>
              <option value="Centro de Triagem">Centro de Triagem</option>
              <option value="ONG">ONG</option>
              <option value="Outro">Outro</option>
            </select>
          </div>

          <div class="form-group">
            <label for="endereco">Endere√ßo Completo *</label>
            <textarea id="endereco" ng-model="vm.formData.endereco" required 
                      placeholder="Rua, n√∫mero, bairro, cidade - Estado"></textarea>
          </div>
        </div>

        <!-- Localiza√ß√£o (Opcional) -->
        <div class="form-section">
          <label class="section-label">üìç Localiza√ß√£o (Opcional)</label>
          <p class="form-help">Se voc√™ souber as coordenadas exatas, pode preench√™-las. Caso contr√°rio, deixe em branco.</p>
          <div class="location-controls">
            <button type="button" class="btn btn-secondary" ng-click="vm.obterLocalizacaoAtual()">
              <span>üìç</span>
              Usar Minha Localiza√ß√£o
            </button>
            <span class="location-status" ng-if="vm.localizacaoObtida">
              ‚úÖ Localiza√ß√£o obtida
            </span>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label for="latitude">Latitude (opcional)</label>
              <input type="number" id="latitude" ng-model="vm.formData.latitude" 
                     step="0.000001" placeholder="-23.5505">
            </div>

            <div class="form-group">
              <label for="longitude">Longitude (opcional)</label>
              <input type="number" id="longitude" ng-model="vm.formData.longitude" 
                     step="0.000001" placeholder="-46.6333">
            </div>
          </div>
        </div>

        <!-- Contato -->
        <div class="form-section">
          <div class="form-row">
            <div class="form-group">
              <label for="telefone">Telefone</label>
              <input type="tel" id="telefone" ng-model="vm.formData.telefone" 
                     placeholder="(11) 99999-9999">
            </div>

            <div class="form-group">
              <label for="horario">Hor√°rio</label>
              <input type="text" id="horario" ng-model="vm.formData.horario" 
                     placeholder="Ex: Seg-Sex: 8h-18h">
            </div>
          </div>
        </div>

        <!-- Materiais Aceitos -->
        <div class="form-section">
          <label class="section-label">‚ôªÔ∏è Materiais Aceitos</label>
          <div class="materiais-grid">
            <label class="material-checkbox" ng-repeat="material in vm.materiaisDisponiveis">
              <input type="checkbox" ng-model="vm.formData.materiais[material]" 
                     ng-true-value="true" ng-false-value="false">
              <span class="material-tag" ng-class="{
                'badge-blue': material === 'Papel',
                'badge-red': material === 'Pl√°stico', 
                'badge-yellow': material === 'Metal',
                'badge-green': material === 'Vidro',
                'badge-brown': material === 'Org√¢nico',
                'badge-purple': material === 'Eletr√¥nicos'
              }">
                {{ material }}
              </span>
            </label>
          </div>
        </div>

        <!-- Mensagens -->
        <div ng-if="vm.mensagem" class="mensagem" ng-class="vm.mensagemTipo">
          {{ vm.mensagem }}
        </div>

        <!-- Bot√µes -->
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" ng-click="vm.fecharModal()">
            Cancelar
          </button>
          <button type="submit" class="btn btn-primary" ng-disabled="vm.salvando">
            <span ng-if="vm.salvando">üíæ</span>
            <span ng-if="!vm.salvando">‚úÖ</span>
            {{ vm.salvando ? 'Salvando...' : 'Cadastrar' }}
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
